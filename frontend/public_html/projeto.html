<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFLIX</title>
    <link rel="stylesheet" href="/frontend/css/projeto.css">
    <link rel="icon" href="/frontend/Imagens/logomarca.png">

</head>

<body>
    <header>
        <h1><img src="/frontend/Imagens/IFLIX.png" alt="Logo IFLIX" onclick="location.reload();" class="IFLIX"></h1>
        <button class="botaoconheca" onclick="window.location.href='conheca.html';">Conheça o IFLIX</button>
        <button class="botaonotas" onclick="window.location.href='anotacoes.html';">Bloco de notas</button>
        <button class="botaosair" onclick="window.location.href='index.html';">Sair</button>
        <!--
        <section>
            <button popovertarget="modal" class="botaosair">⚙️</button>
            <div id="modal" popover="manual" style="
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 600px;           
                        height: 600px;          
                        text-align: center;
                        background: white;
                        padding: 20px;
                        border-radius: 10px;
                        box-shadow: 0 0 15px rgba(0,0,0,0.3);
                        overflow-y: auto;      
                        flex-direction: column;
                        align-items: center;
                    ">
                <button data-close="modal"
                    style="background: transparent; border: none; font-size: x-large; color: red; align-self: flex-end;">
                    ✖
                </button>

                <h2>CONFIGURAÇÕES</h2>
                <h4>Dados Pessoais</h4><br>
                <p>Matrícula: </p>
                <p id="matricula"></p>
                <p>Nome: </p>
                <p id="nome"></p>
                <p>Senha: </p>
                <p id="senha"></p>
                <p>Ano que está cursando: </p>
                <p id="ano"></p>


                <button id="btn-editar">Editar dados</button>
                <button id="btn-apagar-conta">Apagar sua conta</button>
            </div>
        </section>-->

    </header>
    <main>

        <section>
            <h2>FILMES</h2>
            <div id="divfilmes">
                <button style="margin-left: 10px;" onclick="window.location.href='ver_mais1.html';">
                    <img src="/frontend/Imagens/vermais.png" alt="ver mais...">
                </button>
            </div>

            </div>
        </section>

        <section>
            <h2>SÉRIES</h2>
            <div id="divseries">
                <button style="margin-left: 10px;" onclick="window.location.href='ver_mais2.html';">
                    <img src="/frontend/Imagens/vermais.png" alt="ver mais...">
                </button>
        </section>
        <section>
            <h2>LIVROS</h2>
            <div id="divlivros">
                <button style="margin-left: 10px;" onclick="window.location.href='ver_mais3.html';">
                    <img src="/frontend/Imagens/vermais.png" alt="ver mais...">
                </button>
            </div>
        </section>
        <section>
            <h2>CANÇÕES</h2>
            <div id="divmusicas">
                <button style="margin-left: 10px;" onclick="window.location.href='ver_mais4.html';">
                    <img src="/frontend/Imagens/vermais.png" alt="vermais">
                </button>
            </div>
        </section>


        <!-- ===== MODAL 2: DETALHES DA OBRA ===== -->
        <div id="modal2" popover="manual" style="
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 100vh;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
            overflow-y: scroll;
            padding: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 1000;
        ">
            <button data-close="modal2"
                style="background: transparent; border: none; font-size: x-large; color: red; align-self: flex-end;">
                ✖
            </button>


            <div class="carousel-container">
                <div class="custom-carousel" id="modal-carousel"></div>

                <button class="carousel-btn prev-btn">❮</button>
                <button class="carousel-btn next-btn">❯</button>
            </div>

            <h2 id="modal-titulo"></h2>
            <p id="modal-genero" style="font-style: italic; color: gray;"></p>

            <p id="modal-descricao"></p>

            <div style="display: flex; gap: 10px;">
                <a id="modal-anotacoes" href="#" target="_blank"><button>Anotações</button></a>
            </div>

            <p id="modal-disponivel" style="margin-top: 10px; color: gray;"></p>
        </div>
        <div id="overlay" style="
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 999;
        "></div>

        <!--<button class="botao-ajuda">?</button>-->
    </main>
    <footer>
        <p>&copy Todos os direitos reservados</p>
        <p>2025</p>
    </footer>

    <script>
        fetch('http://localhost:3000/api/conteudo')
            .then(res => res.json())
            .then(data => {
                const filmes = document.getElementById('divfilmes');
                const series = document.getElementById('divseries');
                const livros = document.getElementById('divlivros');
                const musicas = document.getElementById('divmusicas');
                const modal2 = document.getElementById('modal2');
                const overlay = document.getElementById('overlay');

                let countFilmes = 0, countSeries = 0, countLivros = 0, countMusicas = 0;

                data.forEach(item => {
                    if (item.tipo === 'Filme' && countFilmes >= 7) return;
                    if (item.tipo === 'Série' && countSeries >= 7) return;
                    if (item.tipo === 'Livro' && countLivros >= 7) return;
                    if (item.tipo === 'Canção' && countMusicas >= 7) return;

                    const btn = document.createElement('button');
                    btn.classList.add('conteudo-btn');
                    btn.style.background = 'transparent';

                    const img = document.createElement('img');
                    img.src = item.url;
                    img.alt = item.titulo;
                    img.style.cursor = 'pointer';
                    btn.appendChild(img);

                    // === Clique do botão abre o modal ===
                    btn.addEventListener('click', () => {
                        document.getElementById('modal-titulo').textContent = item.titulo;
                        document.getElementById('modal-genero').textContent = item.genero || '';
                        document.getElementById('modal-descricao').textContent = item.descricao || 'Sem descrição.';
                        document.getElementById('modal-anotacoes').href = 'anotacoes.html?id=' + item.id;
                        document.getElementById('modal-disponivel').textContent = 'Disponível na: ' + (item.plataformas || 'Plataforma não inserida');

                        const carousel = document.getElementById('modal-carousel');
                        carousel.innerHTML = '';

                        const slides = [];

                        // Slide 1 - imagem principal
                        slides.push(`<div class="imgCarr"><img src="${item.url}" alt="Imagem da obra"></div>`);

                        // Slide 2 - vídeo 1 (trailer)
                        if (item.trailer) {
                            slides.push(`<div><iframe src="${item.trailer}" frameborder="0" REFERRERPOLICY="strict-origin-when-cross-origin" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`);
                        }

                        // Slide 3 - vídeo 2 (resenha)
                        if (item.resenha) {
                            slides.push(`<div><iframe src="${item.resenha}" frameborder="0" REFERRERPOLICY="strict-origin-when-cross-origin" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`);
                        }

                        carousel.innerHTML = slides.join('');

                        // ====== Lógica do carrossel manual ======
                        let currentSlide = 0;
                        const totalSlides = slides.length;

                        const updateCarousel = () => {
                            carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
                        };

                        const prevBtn = document.querySelector('.prev-btn');
                        const nextBtn = document.querySelector('.next-btn');

                        prevBtn.onclick = () => {
                            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                            updateCarousel();
                        };
                        nextBtn.onclick = () => {
                            currentSlide = (currentSlide + 1) % totalSlides;
                            updateCarousel();
                        };

                        modal2.style.display = 'flex';
                        overlay.style.display = 'block';

                        updateCarousel();
                    });

                    // Adiciona o botão no tipo correspondente
                    if (item.tipo === 'Filme') {
                        filmes.appendChild(btn); countFilmes++;
                    } else if (item.tipo === 'Série') {
                        series.appendChild(btn); countSeries++;
                    } else if (item.tipo === 'Livro') {
                        livros.appendChild(btn); countLivros++;
                    } else if (item.tipo === 'Canção') {
                        musicas.appendChild(btn); countMusicas++;
                    }
                });
            });


        // ===== Fechar modal e overlay =====
        const overlay = document.getElementById('overlay');
        overlay.addEventListener('click', () => {
            const modals = document.querySelectorAll('#modal2, #modal');
            modals.forEach(modal => modal.style.display = 'none');
            overlay.style.display = 'none';
        });

        document.querySelectorAll('[data-close]').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.dataset.close;
                const target = document.getElementById(targetId);
                if (target) {
                    target.style.display = 'none';
                    overlay.style.display = 'none';
                }
            });
        });
    </script>
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));

            document.getElementById("matricula").textContent = usuario.matricula;
            document.getElementById("nome").textContent = usuario.nome;
            document.getElementById("senha").textContent = usuario.senha;
            document.getElementById("ano").textContent = usuario.ano;
        });
    </script>
    <script src="/frontend/scripts/script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"));
            const botaoApagar = document.getElementById("btn-apagar-conta");

            if (botaoApagar) {
                botaoApagar.addEventListener("click", () => {
                    excluirUsuario(usuarioLogado.matricula, false);
                });
            }
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"));
            const botaoEditar = document.getElementById("btn-editar");

            if (botaoEditar) {
                botaoEditar.addEventListener("click", () => {
                    editarusuario(usuarioLogado);
                });
            }
        });
    </script>
    <script>
        function editarusuario(usuario) {

            const novoNome = prompt("Novo nome:", usuario.nome);
            if (novoNome === null) return;

            const novaSenha = prompt("Nova senha:", usuario.senha);
            if (novaSenha === null) return;

            const novoAno = prompt("Período que está cursando:", usuario.ano);
            if (novoAno === null) return;

            const dadosAtualizados = {
                nome: novoNome,
                senha: novaSenha,
                ano: novoAno
            };

            fetch(`http://localhost:3000/api/usuarios/${usuario.matricula}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dadosAtualizados),
            })
                .then(res => res.json())
                .then(data => {
                    alert("Dados atualizados com sucesso!");

                    // Atualiza os dados do localStorage para exibir os novos na tela
                    usuario.nome = novoNome;
                    usuario.senha = novaSenha;
                    usuario.ano = novoAno;
                    localStorage.setItem("usuarioLogado", JSON.stringify(usuario));

                    location.reload(); // Atualiza visualmente
                })
                .catch(err => {
                    console.error(err);
                    alert("Erro ao atualizar usuário.");
                });
        }

    </script>
    
</body>
</html>