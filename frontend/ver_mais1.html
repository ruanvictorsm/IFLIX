<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>IFLIX: Filmes</title>
    <link rel="icon" href="/frontend/Imagens/logomarca.png">
    <link rel="stylesheet" href="/frontend/css/vermais.css">
</head>

<body>
    <header style="display: flex; justify-content: left;">
        <img src="/frontend/Imagens/IFLIX.png" alt="Logo" style="width: 250px;" onclick="window.location.href='projeto.html';">
        <a href="/frontend/anotacoes.html">Bloco de notas</a>
        <a href="/frontend/conheca.html">Conheça o IFLIX</a>
        <a href="/frontend/projeto.html"> Voltar para a página inicial</a>
        <a href="/frontend/index.html">Sair da plataforma</a>

    </header>

    <div id="lista-filmes" style="
    display: flex; 
    justify-content: left;
    flex-wrap: wrap; 
    gap: 20px; 
    padding: 10px;">
        <button onclick="window.location.href='projeto.html';" class="btn"><img src="/frontend/Imagens/voltar.png"
                alt="voltar botão"></button>

        <!-- ===== MODAL 2: DETALHES DA OBRA ===== -->
        <div id="modal2" popover="manual" style="
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 100vh;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
            overflow-y: scroll;
            padding: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 1000;
        ">
            <button data-close="modal2"
                style="background: transparent; border: none; font-size: x-large; color: red; align-self: flex-end; cursor: pointer;">
                ✖
            </button>


            <div class="carousel-container">
                <div class="custom-carousel" id="modal-carousel"></div>

                <button class="carousel-btn prev-btn">❮</button>
                <button class="carousel-btn next-btn">❯</button>
            </div>

            <h2 id="modal-titulo"></h2>
            <p id="modal-genero" style="font-style: italic; color: gray;"></p>

            <p id="modal-descricao"></p>

            <div id="modal-estrelas" style="margin: 10px 0; font-size: 40px;">☆☆☆☆☆</div>

            <div style="border: 1px solid black; padding: 10px; max-width: 90%; text-align: left;">
                <strong>Provavelmente area das avaliações:</strong>
                <p id="modal-detalhes"></p>
            </div><br>

            <div style="display: flex; gap: 10px;">
                <a id="modal-anotacoes" href="#" target="_blank"><button class="anot">Anotações</button></a>
            </div>

            <p id="modal-disponivel" style="margin-top: 10px; color: gray;"></p>
        </div>
        <div id="overlay" style="
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 999;
        "></div>

    </div>
    </div>


    <script>
        fetch("http://localhost:3000/api/conteudo")
            .then(res => res.json())
            .then(data => {
                const lista = document.getElementById("lista-filmes");

                data
                    .filter(item => item.tipo === "Filme")
                    .forEach(item => {
                        const card = document.createElement("div");
                        card.classList.add("card-obra");

                        card.innerHTML = `
                    <img src="${item.url}" alt="${item.titulo}">
                `;

                        lista.appendChild(card);
                        card.addEventListener('click', () => {
                            document.getElementById('modal-titulo').textContent = item.titulo;
                            document.getElementById('modal-genero').textContent = item.genero || '';
                            document.getElementById('modal-descricao').textContent = item.descricao || 'Sem descrição.';
                            document.getElementById('modal-anotacoes').href = 'anotacoes.html?id=' + item.id;
                            document.getElementById('modal-disponivel').textContent = 'Disponível na: ' + (item.plataformas || 'Plataforma não inserida');

                            const carousel = document.getElementById('modal-carousel');
                            carousel.innerHTML = '';

                            const slides = [];

                            // Slide 1 - imagem principal
                            slides.push(`<div class="imgCarr"><img src="${item.url}" alt="Imagem da obra"></div>`);

                            // Slide 2 - vídeo 1 (trailer)
                            if (item.trailer) {
                                slides.push(`<div><iframe src="${item.trailer}" frameborder="0" REFERRERPOLICY="strict-origin-when-cross-origin" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`);
                            }

                            // Slide 3 - vídeo 2 (resenha)
                            if (item.resenha) {
                                slides.push(`<div><iframe src="${item.resenha}" frameborder="0" REFERRERPOLICY="strict-origin-when-cross-origin" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`);
                            }

                            carousel.innerHTML = slides.join('');

                            // ====== Lógica do carrossel manual ======
                            let currentSlide = 0;
                            const totalSlides = slides.length;

                            const updateCarousel = () => {
                                carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
                            };

                            const prevBtn = document.querySelector('.prev-btn');
                            const nextBtn = document.querySelector('.next-btn');

                            prevBtn.onclick = () => {
                                currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                                updateCarousel();
                            };
                            nextBtn.onclick = () => {
                                currentSlide = (currentSlide + 1) % totalSlides;
                                updateCarousel();
                            };

                            modal2.style.display = 'flex';
                            overlay.style.display = 'block';

                            updateCarousel();
                        });
                    });

                // ===== Fechar modal e overlay =====
                const overlay = document.getElementById('overlay');
                overlay.addEventListener('click', () => {
                    const modals = document.querySelectorAll('#modal2, #modal');
                    modals.forEach(modal => modal.style.display = 'none');
                    overlay.style.display = 'none';
                });

                document.querySelectorAll('[data-close]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const targetId = btn.dataset.close;
                        const target = document.getElementById(targetId);
                        if (target) {
                            target.style.display = 'none';
                            overlay.style.display = 'none';
                        }
                    });
                });
            });
    </script>



</body>

</html>