<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>IFLIX: Livros</title>
    <link rel="icon" href="/frontend/Imagens/logomarca.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cabin:ital,wght@0,400..700;1,400..700&family=Fira+Code:wght@300..700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #ffffff;
            color: rgb(0, 0, 0);
            font-family: "Cabin", sans-serif;
            font-weight: 400;

        }

        header {
            padding: 1.5rem;
            background-color: black;
            text-align: center;
            color: white;

        }

        .btn {
            border: 2px solid black;

        }

        img {
            width: 10rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .card-obra {
            width: 10rem;
            height: 250px;
            border: 2px solid black;
            padding: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .card-obra:hover {
            transform: scale(1.04);
        }

        .card-obra img {
            height: 100%;
            width: auto;
            display: block;
        }

        .botao {
            text-align: center;
            width: 120px;
            height: 25px;
            border: 2px solid gray;
            font-family: "Cabin", sans-serif;
            cursor: pointer;
            margin-left: 10px;
        }

        .carousel-container {
            position: relative;
            width: 500px;
            height: 940px;
            margin: 20px auto;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0.7;
        }

        .custom-carousel {
            display: flex;
            transition: transform 0.6s ease;
            height: 100%;
            width: 100%;
        }

        .custom-carousel>div {
            min-width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        .custom-carousel img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }

        .custom-carousel iframe {
            width: 100%;
            height: 100%;
            border: none;
            object-fit: cover;
        }

        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.7);
            border: none;
            color: black;
            font-size: 28px;
            cursor: pointer;
            padding: 8px 14px;
            border-radius: 50%;
            transition: background 0.2s;
            z-index: 10;
        }

        .carousel-btn:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .prev-btn {
            left: 10px;
        }

        .next-btn {
            right: 10px;
        }
    </style>
</head>

<body>
    <header style="display: flex; justify-content: left;"><img src="/frontend/Imagens/IFLIX.png" alt="Logo"
            style="width: 250px;">
        <button class="botao" onclick="window.location.href='anotacoes.html';">Bloco de Notas</button>
        <button class="botao">teste</button>

    </header>

    <div id="lista-livro" style="
    display: flex; 
    justify-content: left;
    flex-wrap: wrap; 
    gap: 20px; 
    padding: 10px;">
        <button onclick="window.location.href='projeto.html';" class="btn"><img src="/frontend/Imagens/voltar.png"
                alt="voltar botão"></button>

        <!-- ===== MODAL 2: DETALHES DA OBRA ===== -->
        <div id="modal2" popover="manual" style="
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 100vh;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
            overflow-y: scroll;
            padding: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 1000;
        ">
            <button data-close="modal2"
                style="background: transparent; border: none; font-size: x-large; color: red; align-self: flex-end;">
                ✖
            </button>


            <div class="carousel-container">
                <div class="custom-carousel" id="modal-carousel"></div>

                <button class="carousel-btn prev-btn">❮</button>
                <button class="carousel-btn next-btn">❯</button>
            </div>

            <h2 id="modal-titulo"></h2>
            <p id="modal-genero" style="font-style: italic; color: gray;"></p>

            <p id="modal-descricao"></p>

            <div id="modal-estrelas" style="margin: 10px 0; font-size: 40px;">☆☆☆☆☆</div>

            <div style="border: 1px solid black; padding: 10px; max-width: 90%; text-align: left;">
                <strong>Provavelmente area das avaliações:</strong>
                <p id="modal-detalhes"></p>
            </div><br>

            <div style="display: flex; gap: 10px;">
                <a id="modal-anotacoes" href="#" target="_blank"><button>Anotações</button></a>
            </div>

            <p id="modal-disponivel" style="margin-top: 10px; color: gray;"></p>
        </div>
        <div id="overlay" style="
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 999;
        "></div>
    </div>

    <script>
        fetch("http://localhost:3000/api/conteudo")
            .then(res => res.json())
            .then(data => {
                const lista = document.getElementById("lista-livro");

                data
                    .filter(item => item.tipo === "Livro")
                    .forEach(item => {
                        const card = document.createElement("div");
                        card.classList.add("card-obra");

                        card.innerHTML = `
                    <img src="${item.url}" alt="${item.titulo}">
                `;

                        card.onclick = () => {
                            alert("aqui vai ser gerado os modais");
                        };

                        lista.appendChild(card);
                        card.addEventListener('click', () => {
                            document.getElementById('modal-titulo').textContent = item.titulo;
                            document.getElementById('modal-genero').textContent = item.genero || '';
                            document.getElementById('modal-descricao').textContent = item.descricao || 'Sem descrição.';
                            document.getElementById('modal-anotacoes').href = 'anotacoes.html?id=' + item.id;
                            document.getElementById('modal-disponivel').textContent = 'Disponível na: ' + (item.plataformas || 'Plataforma não inserida');

                            const carousel = document.getElementById('modal-carousel');
                            carousel.innerHTML = '';

                            const slides = [];

                            // Slide 1 - imagem principal
                            slides.push(`<div class="imgCarr"><img src="${item.url}" alt="Imagem da obra"></div>`);

                            // Slide 2 - vídeo 1 (trailer)
                            if (item.trailer) {
                                slides.push(`<div><iframe src="${item.trailer}" frameborder="0" REFERRERPOLICY="strict-origin-when-cross-origin" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`);
                            }

                            // Slide 3 - vídeo 2 (resenha)
                            if (item.resenha) {
                                slides.push(`<div><iframe src="${item.resenha}" frameborder="0" REFERRERPOLICY="strict-origin-when-cross-origin" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`);
                            }

                            carousel.innerHTML = slides.join('');

                            // ====== Lógica do carrossel manual ======
                            let currentSlide = 0;
                            const totalSlides = slides.length;

                            const updateCarousel = () => {
                                carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
                            };

                            const prevBtn = document.querySelector('.prev-btn');
                            const nextBtn = document.querySelector('.next-btn');

                            prevBtn.onclick = () => {
                                currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                                updateCarousel();
                            };
                            nextBtn.onclick = () => {
                                currentSlide = (currentSlide + 1) % totalSlides;
                                updateCarousel();
                            };

                            modal2.style.display = 'flex';
                            overlay.style.display = 'block';

                            updateCarousel();
                        });
                    });
                // ===== Fechar modal e overlay =====
                const overlay = document.getElementById('overlay');
                overlay.addEventListener('click', () => {
                    const modals = document.querySelectorAll('#modal2, #modal');
                    modals.forEach(modal => modal.style.display = 'none');
                    overlay.style.display = 'none';
                });

                document.querySelectorAll('[data-close]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const targetId = btn.dataset.close;
                        const target = document.getElementById(targetId);
                        if (target) {
                            target.style.display = 'none';
                            overlay.style.display = 'none';
                        }
                    });
                });
            });
    </script>
</body>

</html>